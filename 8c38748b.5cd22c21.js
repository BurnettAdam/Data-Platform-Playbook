(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{108:function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a.d(t,"b",(function(){return u}));var n=a(0),r=a.n(n);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function c(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var p=r.a.createContext({}),b=function(e){var t=r.a.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},s=function(e){var t=b(e.components);return r.a.createElement(p.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},m=r.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,i=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),s=b(a),m=n,u=s["".concat(i,".").concat(m)]||s[m]||d[m]||o;return a?r.a.createElement(u,l(l({ref:t},p),{},{components:a})):r.a.createElement(u,l({ref:t},p))}));function u(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,i=new Array(o);i[0]=m;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:n,i[1]=l;for(var p=2;p<o;p++)i[p]=a[p];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,a)}m.displayName="MDXCreateElement"},86:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return i})),a.d(t,"metadata",(function(){return l})),a.d(t,"toc",(function(){return c})),a.d(t,"default",(function(){return b}));var n=a(3),r=a(7),o=(a(0),a(108)),i={title:"Exporting snapshot to s3",description:"Exporting a snapshot of an rds instance to the DataPlatform landing zone",layout:"playbook_js",tags:"playbook"},l={unversionedId:"playbook/snapshot-to-s3",id:"playbook/snapshot-to-s3",isDocsHomePage:!1,title:"Exporting snapshot to s3",description:"Exporting a snapshot of an rds instance to the DataPlatform landing zone",source:"@site/docs/playbook/snapshot-to-s3.md",slug:"/playbook/snapshot-to-s3",permalink:"/Data-Platform-Playbook/playbook/snapshot-to-s3",editUrl:"https://github.com/LBHackney-IT/data-platform-playbook/edit/master/docs/playbook/snapshot-to-s3.md",version:"current",sidebar:"docs",previous:{title:"Using Glue Studio",permalink:"/Data-Platform-Playbook/playbook/using-glue-studio"},next:{title:"Snapshot to S3",permalink:"/Data-Platform-Playbook/docs/snapshot-to-s3"}},c=[{value:"Add rds instance id to the environment variables",id:"add-rds-instance-id-to-the-environment-variables",children:[]},{value:"Create a snapshot of the relevant rds instance",id:"create-a-snapshot-of-the-relevant-rds-instance",children:[]}],p={toc:c};function b(e){var t=e.components,a=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(n.a)({},p,a,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"This guide explains the process of ingesting data from a RDS instance in the AWS API accounts to the DataPlatform landing zone."),Object(o.b)("h2",{id:"add-rds-instance-id-to-the-environment-variables"},"Add rds instance id to the environment variables"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Ensure you have access to the ",Object(o.b)("a",{parentName:"li",href:"https://github.com/LBHackney-IT/data-platform/"},"Data Platform repository")),Object(o.b)("li",{parentName:"ul"},"Login to the AWS management console for the account where the rds instance is located (for UPRN this will be ",Object(o.b)("inlineCode",{parentName:"li"},"ProductionAPIs"),")",Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},"Currently, the deployment is set up to only deploy to the Staging and Production API accounts. This will be refactored to allow us to release into multiple accounts"))),Object(o.b)("li",{parentName:"ul"},"Search for ",Object(o.b)("inlineCode",{parentName:"li"},"RDS")," and select"),Object(o.b)("li",{parentName:"ul"},"Select ",Object(o.b)("inlineCode",{parentName:"li"},"DB Instances")," in the ",Object(o.b)("inlineCode",{parentName:"li"},"Resources")," section"),Object(o.b)("li",{parentName:"ul"},"Copy the ",Object(o.b)("inlineCode",{parentName:"li"},"DB identifier")," of the database you want to export"),Object(o.b)("li",{parentName:"ul"},"Navigate to ",Object(o.b)("a",{parentName:"li",href:"https://github.com/LBHackney-IT/Data-Platform/blob/main/config/terraform/prod.tfvars#L12"},"prod.tfvars")," in the ",Object(o.b)("inlineCode",{parentName:"li"},"config/terraform")," directory and click the pencil icon to edit the file."),Object(o.b)("li",{parentName:"ul"},"Paste the ",Object(o.b)("inlineCode",{parentName:"li"},"Db Identifier")," to the ",Object(o.b)("inlineCode",{parentName:"li"},"rds_instance_ids")," environment variable. Ensure each instance id is double quoted and comma separated as shown below:")),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre"},'rds_instance_ids = ["rds-instance-1", "rds-instance-2"]\n')),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Once the rds instance id has been added, navigate to the bottom of the page and add a short descriptive commit message (80 characters max) and an optional description")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Select the radio button labelled ",Object(o.b)("inlineCode",{parentName:"p"},"Create a new branch for this commit and start a pull request")," and give the new branch an appropriate name (separate words by dashes)")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Select ",Object(o.b)("inlineCode",{parentName:"p"},"Commit changes"))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Populate the pull request template and select ",Object(o.b)("inlineCode",{parentName:"p"},"Create pull request"))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Your pull request is now ready for review by the Data platform team, and your changes will be applied once they have approved and merged your pull request and a new production release has been made")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"You can view the progress of the staging and production release by navigating to the ",Object(o.b)("a",{parentName:"p",href:"https://github.com/LBHackney-IT/Data-Platform/actions"},"actions tab")," of the repository"),Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"To verify that your changes have been released to the production environment, check that there is a workflow with your release.")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Once the workflow has successfully completed, your changes will have been deployed to production"),Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},"The workflow for the staging deployment will contain the following text under the workflow title:")),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",{parentName:"pre"},"Data-Platform (Staging) #XXX: Commit XXXX pushed by xxxxx\n")),Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},"The production release workflow will contain the following text under the workflow title:")),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",{parentName:"pre"},"Data-Platform (Production) #X: Release X.X.X published by xxxxx\n\n")))))),Object(o.b)("h2",{id:"create-a-snapshot-of-the-relevant-rds-instance"},"Create a snapshot of the relevant rds instance"),Object(o.b)("p",null,"Once your pull request has been approved and released to production, you will need to log in to the relevant AWS account to create a snapshot"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Search for ",Object(o.b)("inlineCode",{parentName:"p"},"RDS")," and select")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"On the sidebar, click on ",Object(o.b)("inlineCode",{parentName:"p"},"Snapshots"))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Select ",Object(o.b)("inlineCode",{parentName:"p"},"Take snapshot")," on the Manual tab")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"On ",Object(o.b)("inlineCode",{parentName:"p"},"Take a Snapshot")," page, use the ",Object(o.b)("inlineCode",{parentName:"p"},"DB Instance")," drop down and select the rds instance id as your DB instance"),Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},"In the ",Object(o.b)("inlineCode",{parentName:"li"},"Snapshot Name")," input field, add a name for your snapshot according to the following convention, (rds_instance_id)-dataplatform-YYYY-MM-DD-(optional_descriptor) e.g.:")),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",{parentName:"pre"},"golive-db-dataplatform-15-05-2021\n"))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"click ",Object(o.b)("inlineCode",{parentName:"p"},"Take snapshot"))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"The snapshot should immediately appear in the ",Object(o.b)("inlineCode",{parentName:"p"},"Manual")," tab in the ",Object(o.b)("inlineCode",{parentName:"p"},"Manual snapshots")," list")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"The snapshot is complete when it has a ",Object(o.b)("inlineCode",{parentName:"p"},"Snapshot creation time"))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Once the snapshot has been created, it will automatically trigger the export process to the Data Platform landing zone bucket")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"First it will export a copy of the db instance in parquet format to an S3 bucket in the same service account. Once this is complete, it will be exported from the service account bucket to the landing zone S3 bucket in the Data Platform account (see ",Object(o.b)("a",{parentName:"p",href:"http://playbook.hackney.gov.uk/Data-Platform-Playbook/docs/snapshot-to-s3/"},"snapshot to S3 page")," for more detail on the ingestion process)")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"You can view the progress of the first export by navigating to ",Object(o.b)("inlineCode",{parentName:"p"},"Exports in Amazon S3")," tab. This will take about an hour to complete")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Once the export has completed, you can view it by clicking on the link in the ",Object(o.b)("inlineCode",{parentName:"p"},"S3 bucket")," column which will take you to the relevant directory in ",Object(o.b)("inlineCode",{parentName:"p"},"dataplatform-prod-rds-export-storage")," bucket where all the initial exports are stored")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Shortly after this, the data will become available in the Data Platform account")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"To view this, switch to the ",Object(o.b)("inlineCode",{parentName:"p"},"DataPlatform-Production")," account")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Search for ",Object(o.b)("inlineCode",{parentName:"p"},"S3")," and select")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Select ",Object(o.b)("inlineCode",{parentName:"p"},"dataplatform-prod-landing-zone")," and navigate to the relevant department folder"))))}b.isMDXComponent=!0}}]);