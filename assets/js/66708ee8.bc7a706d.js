"use strict";(self.webpackChunkdata_platform_playbook=self.webpackChunkdata_platform_playbook||[]).push([[8649],{3905:function(e,t,a){a.d(t,{Zo:function(){return m},kt:function(){return c}});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var p=n.createContext({}),s=function(e){var t=n.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},m=function(e){var t=s(e.components);return n.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,p=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),d=s(a),c=r,h=d["".concat(p,".").concat(c)]||d[c]||u[c]||o;return a?n.createElement(h,i(i({ref:t},m),{},{components:a})):n.createElement(h,i({ref:t},m))}));function c(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=d;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var s=2;s<o;s++)i[s]=a[s];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},5624:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return l},contentTitle:function(){return p},metadata:function(){return s},toc:function(){return m},default:function(){return d}});var n=a(7462),r=a(3366),o=(a(7294),a(3905)),i=["components"],l={id:"deploy-glue-jobs",title:"Deploying Glue jobs to the Data Platform",description:"Creating Glue jobs in terraform",layout:"playbook_js",tags:["playbook"]},p=void 0,s={unversionedId:"playbook/transforming-data/using-aws-glue/deploy-glue-jobs",id:"playbook/transforming-data/using-aws-glue/deploy-glue-jobs",isDocsHomePage:!1,title:"Deploying Glue jobs to the Data Platform",description:"Creating Glue jobs in terraform",source:"@site/docs/playbook/transforming-data/using-aws-glue/002-deploy-glue-jobs.md",sourceDirName:"playbook/transforming-data/using-aws-glue",slug:"/playbook/transforming-data/using-aws-glue/deploy-glue-jobs",permalink:"/Data-Platform-Playbook/playbook/transforming-data/using-aws-glue/deploy-glue-jobs",editUrl:"https://github.com/LBHackney-IT/data-platform-playbook/edit/master/docs/playbook/transforming-data/using-aws-glue/002-deploy-glue-jobs.md",tags:[{label:"playbook",permalink:"/Data-Platform-Playbook/tags/playbook"}],version:"current",sidebarPosition:2,frontMatter:{id:"deploy-glue-jobs",title:"Deploying Glue jobs to the Data Platform",description:"Creating Glue jobs in terraform",layout:"playbook_js",tags:["playbook"]},sidebar:"docs",previous:{title:"Using Glue Studio",permalink:"/Data-Platform-Playbook/playbook/transforming-data/using-aws-glue/using-glue-studio"},next:{title:"Scheduling Liberator Glue Jobs",permalink:"/Data-Platform-Playbook/playbook/transforming-data/using-aws-glue/practical-examples/scheduling-liberator-glue-jobs"}},m=[{value:"Deploying Glue jobs to the Data Platform using the Glue jobs Terraform template",id:"deploying-glue-jobs-to-the-data-platform-using-the-glue-jobs-terraform-template",children:[{value:"1. Add your script to the Data Platform Project using the GitHub UI",id:"1-add-your-script-to-the-data-platform-project-using-the-github-ui",children:[]},{value:"2. Copy an existing Glue job module block or use the example below and populate the necessary variables",id:"2-copy-an-existing-glue-job-module-block-or-use-the-example-below-and-populate-the-necessary-variables",children:[]},{value:"3. Committing your changes using the GitHub UI",id:"3-committing-your-changes-using-the-github-ui",children:[]}]},{value:"Example module block",id:"example-module-block",children:[]}],u={toc:m};function d(e){var t=e.components,a=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"deploying-glue-jobs-to-the-data-platform-using-the-glue-jobs-terraform-template"},"Deploying Glue jobs to the Data Platform using the Glue jobs Terraform template"),(0,o.kt)("div",{className:"admonition admonition-important alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"important")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"This guide contains instructions on how to deploy your Glue job to the Data Platform using the GitHub UI.\nIt assumes you have finished developing your script, and it is ready to be deployed to the Data Platform.\nIf you are still testing or prototyping your script, it is recommended that you refer to ",(0,o.kt)("a",{parentName:"p",href:"./using-glue-studio"},"this guide")," first."))),(0,o.kt)("h3",{id:"1-add-your-script-to-the-data-platform-project-using-the-github-ui"},"1. Add your script to the Data Platform Project using the GitHub UI"),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"If your Glue job was created using the Glue Studio UI,\nyou can find the automatically generated script by navigating to the ",(0,o.kt)("inlineCode",{parentName:"p"},"Script")," tab when viewing your job in Glue Studio."))),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Open the ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/LBHackney-IT/Data-Platform/tree/main/scripts"},"scripts directory")," in the Data Platform Project and navigate to your department folder"),(0,o.kt)("li",{parentName:"ul"},"Click ",(0,o.kt)("inlineCode",{parentName:"li"},"Add file")," and then ",(0,o.kt)("inlineCode",{parentName:"li"},"Create new file")),(0,o.kt)("li",{parentName:"ul"},"Name your file, using underscores as separators e.g. ",(0,o.kt)("inlineCode",{parentName:"li"},"address_cleaning_housing_repairs"),", and then paste your code in field below"),(0,o.kt)("li",{parentName:"ul"},"Follow ",(0,o.kt)("a",{parentName:"li",href:"#3-committing-your-changes-using-the-github-ui"},"the instructions here")," to commit your new file to the project")),(0,o.kt)("h3",{id:"2-copy-an-existing-glue-job-module-block-or-use-the-example-below-and-populate-the-necessary-variables"},"2. Copy an existing Glue job module block or use the example below and populate the necessary variables"),(0,o.kt)("p",null,"Once the Pull Request to add your script has been approved, and you have confirmed that your script is in the Data Platform Project,\nyou can proceed with this step.\nIn this step, you will be creating a module which will deploy your Glue job (and crawler) to the Data Platform Project."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Open the ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/LBHackney-IT/data-platform"},"Data Platform Project")," in GitHub\nIf you don't have the correct permissions, you'll get a '404' error (see ",(0,o.kt)("a",{parentName:"li",href:"/Data-Platform-Playbook/playbook/ingesting-data/google-sheets-import#prerequisites"},"prerequisites"),")."),(0,o.kt)("li",{parentName:"ul"},"Navigate to the main ",(0,o.kt)("inlineCode",{parentName:"li"},"terraform")," directory. Open ",(0,o.kt)("inlineCode",{parentName:"li"},"23-aws-glue-jobs-<YOUR-DEPARTMENT-NAME>.tf"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("em",{parentName:"li"},"if this file does not exist, create a new terraform file for your department by clicking ",(0,o.kt)("inlineCode",{parentName:"em"},"Add file")," then ",(0,o.kt)("inlineCode",{parentName:"em"},"Create new file"),".\nThe name of the new file should be:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"23-aws-glue-jobs-<YOUR-DEPARTMENT-NAME>.tf\n")),(0,o.kt)("em",{parentName:"li"},"Refer to the ",(0,o.kt)("a",{parentName:"em",href:"#example-module-block"},"example")," below to get started.")))),(0,o.kt)("li",{parentName:"ul"},"Click ",(0,o.kt)("inlineCode",{parentName:"li"},"edit")," or the pencil icon and copy and paste an existing module block."),(0,o.kt)("li",{parentName:"ul"},"When updating the module:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Do not change any spacing before the ",(0,o.kt)("inlineCode",{parentName:"li"},"=")),(0,o.kt)("li",{parentName:"ul"},"Do not remove the ",(0,o.kt)("inlineCode",{parentName:"li"},'"quotation marks"')," around any values which use them"),(0,o.kt)("li",{parentName:"ul"},"When adding a variable that does not already exist, paste the variable name and then intended value after the ",(0,o.kt)("inlineCode",{parentName:"li"},"="),"\nand ensure that all equal signs (",(0,o.kt)("inlineCode",{parentName:"li"},"="),") line up as shown in the example")))),(0,o.kt)("p",null,"Update the ",(0,o.kt)("inlineCode",{parentName:"p"},"module")," name using the name convention ",(0,o.kt)("inlineCode",{parentName:"p"},"<job_name>_<department_name>"),', for example "liberator_pcn_denormalisation_housing_repairs".\nThe module name must be all lowercase with words separated by underscores. Ensure it\'s unique to all other module names in this file.'),(0,o.kt)("h4",{id:"the-following-input-variables-are-required"},"The following input variables are required:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"department")," (required): This will be ",(0,o.kt)("inlineCode",{parentName:"p"},"module.department_<YOUR_DEPARTMENT_NAME>")),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("em",{parentName:"p"},"Note: the department name should be all lowercase and separated by underscores\ne.g. ",(0,o.kt)("inlineCode",{parentName:"em"},"module.department_housing_repairs")))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"job_name")," (required): The name of your glue job prefixed with ",(0,o.kt)("inlineCode",{parentName:"p"},"${local.short_identifier_prefix}")," and your department name e.g."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},'"${local.short_identifier_prefix}housing repairs address cleaning"\n'))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"helper_module_key")," (required): This will be ",(0,o.kt)("inlineCode",{parentName:"p"},"aws_s3_bucket_object.helpers.key"),". It is the S3 object key for the helpers python module.\nThis gives you access to all of the functions defined in the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/LBHackney-IT/Data-Platform/tree/main/scripts/helpers"},"helpers folder"),". You can add new files or functions to the folder and they will be available in your glue jobs.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"pydeequ_zip_key")," (required): This will be ",(0,o.kt)("inlineCode",{parentName:"p"},"aws_s3_bucket_object.pydeequ.key"),". It is the S3 object key for the PyDeequ python library, which is used for data quality testing in the Data Platform.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("h4",{parentName:"li",id:"script-name-location-required"},"Script Name/ Location (required)"),(0,o.kt)("p",{parentName:"li"},"One of the following variables must be populated.\nIf you are adding a new script to only be used for one glue job you should provide a value for ",(0,o.kt)("strong",{parentName:"p"},"script_name")," and leave the second blank.\nIf your script file is already saved in S3 you should provide ",(0,o.kt)("strong",{parentName:"p"},"script_s3_object_key"),"."),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"script_name")," : Name of the Glue job script. Set this to the name of the script file you created in ",(0,o.kt)("a",{parentName:"li",href:"#1-add-your-script-to-the-data-platform-project"},"step 1"),(0,o.kt)("br",{parentName:"li"}),"e.g. ",(0,o.kt)("inlineCode",{parentName:"li"},'"address_cleaning_housing_repairs"'),". This file must be saved within your departmental folder.\n",(0,o.kt)("em",{parentName:"li"},"Note: you must add quotes around the script name as shown in the example.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"script_s3_object_key")," : S3 object key of the script file.\nIf your script is used accross multiple jobs it may already be saved in S3, in this case you can provide the key for that object within the scripts S3 bucket e.g. ",(0,o.kt)("inlineCode",{parentName:"li"},"aws_s3_bucket_object.address_matching.key"),".")))),(0,o.kt)("h4",{id:"the-following-variables-are-optional"},"The following variables are optional:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("h4",{parentName:"li",id:"variables-used-for-scheduling-a-glue-job"},"Variables used for scheduling a Glue job"),(0,o.kt)("p",{parentName:"li"},"To schedule your Glue job, you will need to set one of the following optional variables:\n",(0,o.kt)("strong",{parentName:"p"},"triggered_by_crawler"),", ",(0,o.kt)("strong",{parentName:"p"},"triggered_by_job")," or ",(0,o.kt)("strong",{parentName:"p"},"schedule"),".\nThe job created in this module will be triggered on completion of either\nthe crawler specified in ",(0,o.kt)("strong",{parentName:"p"},"triggered_by_crawler"),", the job specified in ",(0,o.kt)("strong",{parentName:"p"},"triggered_by_job"),", or the ",(0,o.kt)("strong",{parentName:"p"},"schedule"),"."),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("em",{parentName:"p"},"Note: the placeholder variable ",(0,o.kt)("inlineCode",{parentName:"em"},"<NAME_OF_GLUE_JOB_MODULE>")," used in ",(0,o.kt)("strong",{parentName:"em"},"trigger_by_job")," and ",(0,o.kt)("strong",{parentName:"em"},"triggered_by_crawler"),"\nrefers to the existing Glue job module from which the job or crawler is being referenced")),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"triggered_by_crawler")," (optional): The Glue crawler that will trigger this job e.g.")),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"module.<NAME_OF_GLUE_JOB_MODULE>.crawler_name\n")),(0,o.kt)("p",{parentName:"li"},"From the ",(0,o.kt)("a",{parentName:"p",href:"#example-module-block"},"example template below"),", the name of the Glue job module would be ",(0,o.kt)("inlineCode",{parentName:"p"},"manually_uploaded_parking_data_to_raw"),", and therefore you would write:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"module.manually_uploaded_parking_data_to_raw.crawler_name\n")),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"triggered_by_job")," (optional): The Glue job that will trigger this job e.g.")),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"module.<NAME_OF_GLUE_JOB_MODULE>.job_name\n")),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"schedule")," (optional): Schedule to run the Glue job specified using Cron expressions (see ",(0,o.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/AmazonCloudWatch/latest/events/ScheduledEvents.html#CronExpressions"},"AWS Cron Expression documentation"),")."),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"For example, if you wanted your Glue job to run at 23:00:00pm, on every Monday, Tuesday, Wednesday, Thursday and Friday, every month,\nyour Cron expression would look like:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},'"cron(0 0 23 ? * MON,TUE,WED,THU,FRI *)"\n'))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"You can use ",(0,o.kt)("a",{parentName:"p",href:"https://www.freeformatter.com/cron-expression-generator-quartz.html"},"this tool")," to generate your Cron expressions.")))))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"job_description"),' (optional): A description of the AWS glue job e.g. "Exports Google Sheets imported datasets to the landing zone"')),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"job_parameters")," (optional): If your Glue job uses environment variables/ job parameters, you can set them here.\nAdd this import statement to your script: ",(0,o.kt)("inlineCode",{parentName:"p"},"from helpers.helpers import get_glue_env_var"),"\nto retrieve the job parameters you set here."),(0,o.kt)("p",{parentName:"li"},"You can then get the value of your job parameters to use in your script like this:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"s3_target_location = get_glue_env_var('s3_bucket_target', '')\n")),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"In the following optional job parameters; ",(0,o.kt)("em",{parentName:"p"},'"--s3_bucket_target"'),", ",(0,o.kt)("em",{parentName:"p"},'"--s3_bucket_source"')," and ",(0,o.kt)("em",{parentName:"p"},'"--source_catalog_database"'),":"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"<ZONE>")," refers to either: ",(0,o.kt)("inlineCode",{parentName:"p"},"raw"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"landing"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"refined"),", or ",(0,o.kt)("inlineCode",{parentName:"p"},"trusted")," S3 or Glue database zones.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Specifically for ",(0,o.kt)("em",{parentName:"p"},'"--s3_bucket_target"')," and ",(0,o.kt)("em",{parentName:"p"},'"--s3_bucket_source"'),", and any other S3 location path,\nensure that your department name and folder name is all lowercase and hyphen separated if necessary\nand that there is a ",(0,o.kt)("inlineCode",{parentName:"p"},'"/"'),' after the folder name. For example, if your department is "Housing Repairs", it\nshould be written as ',(0,o.kt)("inlineCode",{parentName:"p"},"housing-repairs"),"."),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("em",{parentName:"p"},'"--s3_bucket_target"')," (optional): the output S3 location for your Glue job\ne.g."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},'"s3://${module.<ZONE>_zone.bucket_id}/<YOUR_DEPARTMENT_NAME>/<FOLDER_NAME>/"\n'))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("em",{parentName:"p"},'"--s3_bucket_source"')," (optional): the S3 source of the data used in the glue job\ne.g."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},'"s3://${module.<ZONE>_zone.bucket_id}/<YOUR_DEPARTMENT_NAME>/<FOLDER_NAME>/"\n'))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("em",{parentName:"p"},'"--source_catalog_database"')," (optional): the Glue database which contains the Glue ",(0,o.kt)("em",{parentName:"p"},"source_catalog table")," needed for the Glue job\ne.g."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"module.department_<YOUR_DEPARTMENT_NAME>.<ZONE>_catalog_database_name\n")),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("em",{parentName:"li"},"Note: ensure that your department name is all lowercase with words separated by underscores\ne.g. ",(0,o.kt)("inlineCode",{parentName:"em"},"housing_repairs"),".")))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("em",{parentName:"p"},'"--source_catalog_table"')," (optional): the Glue catalog source table of the data used in the Glue job\ne.g. ",(0,o.kt)("inlineCode",{parentName:"p"},'"housing_repairs_repairs_purdy"')),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("em",{parentName:"li"},"Note: if sourcing data from a catalog table, the "),(0,o.kt)("inlineCode",{parentName:"li"},"--source_catalog_database"),(0,o.kt)("em",{parentName:"li"}," job parameter must be set as well"))))))))))),(0,o.kt)("p",null,"See the ",(0,o.kt)("a",{parentName:"p",href:"#example-module-block"},"example module")," below for guidance on how to set your own job parameters."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"workflow_name")," (optional): An existing workflow to add the triggers to"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("em",{parentName:"li"},"Note: this module ",(0,o.kt)("strong",{parentName:"em"},"does not")," create Glue workflows")))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"crawler_details")," (optional): Inputs required to create a crawler. If this variable is not provided then no crawler will be created. These are:"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("em",{parentName:"p"},"database_name"),": Glue database where results are written"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"module.department_<YOUR_DEPARTMENT_NAME>.<S3_BUCKET_ZONE>_catalog_database_name\n")),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Where ",(0,o.kt)("inlineCode",{parentName:"li"},"<S3_BUCKET_ZONE>")," can be either: ",(0,o.kt)("inlineCode",{parentName:"li"},"raw"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"landing"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"refined"),", or ",(0,o.kt)("inlineCode",{parentName:"li"},"trusted")))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("em",{parentName:"p"},"s3_target_location"),": The S3 location to be crawled.\nThis will likely be the same as the value of Glue job job parameter: ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("inlineCode",{parentName:"strong"},"--s3_bucket_target"))),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},'"s3://${module.<S3_BUCKET_ZONE>_zone_bucket_id}/<YOUR_DEPARTMENT_NAME>/<FOLDER_NAME>/"\n'))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("em",{parentName:"p"},"table_prefix")," (Optional): The table prefix used for catalog tables that are created in the specified Glue database (",(0,o.kt)("strong",{parentName:"p"},"database_name")," variable set above) in ",(0,o.kt)("strong",{parentName:"p"},"Athena"),",\nafter crawling the ",(0,o.kt)("strong",{parentName:"p"},"s3_target_location")," e.g. ",(0,o.kt)("inlineCode",{parentName:"p"},'"housing_repairs_"'))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("em",{parentName:"p"},"configuration")," (Optional): By default, the ",(0,o.kt)("inlineCode",{parentName:"p"},"TableGroupingPolicy")," will be set to ",(0,o.kt)("inlineCode",{parentName:"p"},"CombineCompatibleSchemas"))))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"max_concurrent_runs_of_glue_job")," (optional): Max number of concurrent runs for the Glue job. The is set to ",(0,o.kt)("strong",{parentName:"p"},"1")," by default.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"trigger_enabled")," (optional): Set to ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("inlineCode",{parentName:"strong"},"false"))," to disable scheduled or conditional triggers for the Glue job.\nThis is set to ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("inlineCode",{parentName:"strong"},"true"))," by default. ",(0,o.kt)("em",{parentName:"p"},"Note: the value of this variable does not need to be surrounded by quotes."))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("h4",{parentName:"li",id:"optional-variables-used-for-configuring-the-capacity-a-glue-job"},"Optional variables used for configuring the capacity a Glue job"),(0,o.kt)("p",{parentName:"li"},"To change the capacity of your Glue job, you will need to set the following ",(0,o.kt)("strong",{parentName:"p"},"glue_job_worker_type")," and ",(0,o.kt)("strong",{parentName:"p"},"number_of_workers_for_glue_job")," variables.\nIn most instances, the default settings are fine, and you would only need to set or change these variables if your Glue job is processing very large datasets\nor performing complex transformations."),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"number_of_workers_for_glue_job")," (optional): The number of workers to use for the glue job. The is set to ",(0,o.kt)("strong",{parentName:"li"},"2")," by default."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"glue_job_worker_type")," (optional): Worker type for Glue job (see ",(0,o.kt)("a",{parentName:"li",href:"https://docs.aws.amazon.com/glue/latest/dg/add-job.html#:~:text=Own%20Custom%20Scripts.-,Worker%20type,-The%20following%20worker"},"AWS documentation on 'Worker types"),"'). The default is ",(0,o.kt)("strong",{parentName:"li"},"Standard"),'. This can either be set as "Standard", "G.1X" or "G.2X".')))),(0,o.kt)("p",null,"Once you have finished creating your Glue job using the template and have populated all relevant variables,\nyou should refer to step 3 below to have your job submitted for review by the Data Platform team."),(0,o.kt)("h3",{id:"3-committing-your-changes-using-the-github-ui"},"3. Committing your changes using the GitHub UI"),(0,o.kt)("p",null,"The Data Platform team needs to approve any changes to the code, so your change won't happen automatically. To submit your change:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Navigate to the ",(0,o.kt)("inlineCode",{parentName:"li"},"Commit new file")," or ",(0,o.kt)("inlineCode",{parentName:"li"},"Commit changes")," section at the bottom of the page."),(0,o.kt)("li",{parentName:"ul"},"Provide a short sentence in the first field and then an optional description in the field below to explain what you've changed."),(0,o.kt)("li",{parentName:"ul"},"Select the option to create a ",(0,o.kt)("inlineCode",{parentName:"li"},"new branch")," for this commit (i.e. the code you've changed).\nYou can just use the suggested name for your branch."),(0,o.kt)("li",{parentName:"ul"},"Once you click ",(0,o.kt)("inlineCode",{parentName:"li"},"Commit new file")," or ",(0,o.kt)("inlineCode",{parentName:"li"},"Commit changes")," you'll have the opportunity to add even more detail if needed before submitting it for review.",(0,o.kt)("br",{parentName:"li"}),"Click ",(0,o.kt)("inlineCode",{parentName:"li"},"Create Pull Request")," when finished."),(0,o.kt)("li",{parentName:"ul"},"The Data Platform team will then review your Pull Request, and you'll receive an email to confirm when your changes have been approved.")),(0,o.kt)("h2",{id:"example-module-block"},"Example module block"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-markdown"},'module "manually_uploaded_parking_data_to_raw" {\n  source = "../modules/aws-glue-job"\n\n  department = module.department*housing_repairs\n  job_name   = "${local.short_identifier_prefix}housing repairs address cleaning"\n  schedule   = "cron(0 0 23 ? * MON,TUE,WED,THU,FRI _)"\n  job_parameters = {\n    "--s3_bucket_target" = module.raw_zone.bucket_id\n    "--s3_bucket_source" = "${module.landing_zone.bucket_id}/housing-repairs/repairs-axis/"\n  }\n  crawler_details = {\n    database_name      = module.department_housing_repairs.raw_zone_catalog_database_name\n    s3_target_location = "s3://${module.raw_zone.bucket_id}/housing-repairs/repairs-axis/"\n    table_prefix       = "housing_repairs_"\n  }\n}\n')))}d.isMDXComponent=!0}}]);