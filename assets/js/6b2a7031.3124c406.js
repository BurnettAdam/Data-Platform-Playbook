"use strict";(self.webpackChunkdata_platform_playbook=self.webpackChunkdata_platform_playbook||[]).push([[5721],{3905:function(e,t,a){a.d(t,{Zo:function(){return d},kt:function(){return p}});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),c=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},d=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),h=c(a),p=r,m=h["".concat(s,".").concat(p)]||h[p]||u[p]||i;return a?n.createElement(m,o(o({ref:t},d),{},{components:a})):n.createElement(m,o({ref:t},d))}));function p(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var c=2;c<i;c++)o[c]=a[c];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"},3532:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return c},toc:function(){return d},default:function(){return h}});var n=a(7462),r=a(3366),i=(a(7294),a(3905)),o=["components"],l={title:"Redshift Configuration",description:"",layout:"playbook_js",tags:["playbook"]},s=void 0,c={unversionedId:"docs/redshift",id:"docs/redshift",isDocsHomePage:!1,title:"Redshift Configuration",description:"",source:"@site/docs/docs/redshift.md",sourceDirName:"docs",slug:"/docs/redshift",permalink:"/Data-Platform-Playbook/docs/redshift",editUrl:"https://github.com/LBHackney-IT/data-platform-playbook/edit/master/docs/docs/redshift.md",tags:[{label:"playbook",permalink:"/Data-Platform-Playbook/tags/playbook"}],version:"current",frontMatter:{title:"Redshift Configuration",description:"",layout:"playbook_js",tags:["playbook"]},sidebar:"docs",previous:{title:"Import XLXS from G Drive",permalink:"/Data-Platform-Playbook/docs/import-xlsx-from-g-drive"},next:{title:"VPC Peering Connection between Data Platform and Production APIs AWS accounts",permalink:"/Data-Platform-Playbook/docs/vpc-peering-connection-dataplatform-and-production-apis-account"}},d=[{value:"Objective / Who is this for?",id:"objective--who-is-this-for",children:[]},{value:"Prerequisites",id:"prerequisites",children:[]},{value:"Collection Structure",id:"collection-structure",children:[]},{value:"Open Redshift Query Editor",id:"open-redshift-query-editor",children:[]},{value:"Connect to the Database",id:"connect-to-the-database",children:[]},{value:"Create a User",id:"create-a-user",children:[]},{value:"External Schema",id:"external-schema",children:[{value:"Adding an External Schema requirements",id:"adding-an-external-schema-requirements",children:[]}]},{value:"Finding the name of the AWS Glue Database to be added",id:"finding-the-name-of-the-aws-glue-database-to-be-added",children:[]},{value:"Finding the IAM Role details",id:"finding-the-iam-role-details",children:[]},{value:"Schema Name ?",id:"schema-name-",children:[{value:"Adding an External Schema",id:"adding-an-external-schema",children:[]},{value:"Granting a User Access",id:"granting-a-user-access",children:[]}]},{value:"Storing the credentials of the created user in a parameters store?",id:"storing-the-credentials-of-the-created-user-in-a-parameters-store",children:[]},{value:"How do we know if it worked?",id:"how-do-we-know-if-it-worked",children:[]},{value:"Are there any more steps?",id:"are-there-any-more-steps",children:[]}],u={toc:d};function h(e){var t=e.components,a=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"objective--who-is-this-for"},"Objective / Who is this for?"),(0,i.kt)("p",null,"After this article, you should be able to"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Create a user in redshift ?"),(0,i.kt)("li",{parentName:"ul"},"Create a schema for your tables ?"),(0,i.kt)("li",{parentName:"ul"},"Grant permissions to a user to view the tables ?")),(0,i.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,i.kt)("p",null,"In order to complete this article, you will need"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"(fill in)"),(0,i.kt)("li",{parentName:"ul"},"Access to Amazon Redshift"),(0,i.kt)("li",{parentName:"ul"},"Access to Amazon Glue Databases")),(0,i.kt)("h2",{id:"collection-structure"},"Collection Structure"),(0,i.kt)("p",null,"Unlike most Database services. Redshift has a three tier collection setup:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"The top most tier is called a Database, a Database contains multiple Schemas"),(0,i.kt)("li",{parentName:"ol"},"The second tier is called a Schema, a Schema contains multiple Tables"),(0,i.kt)("li",{parentName:"ol"},"The final tier is called a Table, a Table contains multiple rows of data or references a location in S3")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Database -> Schema -> Table")),(0,i.kt)("h2",{id:"open-redshift-query-editor"},"Open Redshift Query Editor"),(0,i.kt)("p",null,'Use the search bar at the top of AWS to search for Redshift. Then on the left, go to "Editor" then "Query Editor"'),(0,i.kt)("h2",{id:"connect-to-the-database"},"Connect to the Database"),(0,i.kt)("p",null,"(fill in)"),(0,i.kt)("h2",{id:"create-a-user"},"Create a User"),(0,i.kt)("p",null,"To create a new user in Redshift, run the following command as a query:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE USER {username} WITH PASSWORD '{password}';\n")),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE USER housing_repairs WITH PASSWORD 'th1s1sANEx&mpl3';\n")),(0,i.kt)("h2",{id:"external-schema"},"External Schema"),(0,i.kt)("p",null,"Redshift Spectrum is able to access data in S3 that has been cataloged via AWS Glue by creating an external\nschema. An external schema acts like a database but instead of holding the data within the redshift cluster it uses an\nattached IAM role to read the data from S3."),(0,i.kt)("h3",{id:"adding-an-external-schema-requirements"},"Adding an External Schema requirements"),(0,i.kt)("p",null,"To create an External Schema you will need the name of the AWS Glue Database to be added. An IAM role that can be used\nto read the data from S3 (A role has been included in the Data Platform) and a schema name that the database will be\ndisplayed as."),(0,i.kt)("h2",{id:"finding-the-name-of-the-aws-glue-database-to-be-added"},"Finding the name of the AWS Glue Database to be added"),(0,i.kt)("p",null,"(fill in)"),(0,i.kt)("h2",{id:"finding-the-iam-role-details"},"Finding the IAM Role details"),(0,i.kt)("p",null,"(fill in)"),(0,i.kt)("h2",{id:"schema-name-"},"Schema Name ?"),(0,i.kt)("p",null,"(Fill in)"),(0,i.kt)("h3",{id:"adding-an-external-schema"},"Adding an External Schema"),(0,i.kt)("p",null,"Execute the following SQL against the Redshift Cluster:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"CREATE EXTERNAL SCHEMA {schema-name}\n    FROM DATA CATALOG\n    DATABASE '{aws-glue-database}'\n    IAM_ROLE 'arn:aws:iam::{aws-account-id}:role/dataplatform-{environment}-redshift-role'\n    CREATE EXTERNAL DATABASE IF NOT EXISTS;\n")),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE EXTERNAL SCHEMA housing_repairs_raw_zone\n    FROM DATA CATALOG\n    DATABASE 'housing-repairs-raw-zone'\n    IAM_ROLE 'arn:aws:iam::000000000000:role/dataplatform-stg-redshift-role'\n    CREATE EXTERNAL DATABASE IF NOT EXISTS;\n")),(0,i.kt)("h3",{id:"granting-a-user-access"},"Granting a User Access"),(0,i.kt)("p",null,"For a user to be able to access an external schema, they must first be granted the temp permission on the containing\ndatabase. Execute the following SQL against the Redshift Cluster:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"GRANT temp\n    ON DATABASE {database-name}\n    TO {username};\n")),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"GRANT temp\n    ON DATABASE data_platform\n    TO housing_repairs;\n")),(0,i.kt)("p",null,"Once a user has the temp permission of a specific database, they then need to be granted permissions on each External\nSchema that they need access to. Run the following commands for each Schema:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"GRANT USAGE\n    ON SCHEMA {schema-name}\n    TO {username};\n\nGRANT SELECT\n    ON ALL TABLES IN SCHEMA {schema-name}\n    TO {username};\n")),(0,i.kt)("p",null,"Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"GRANT USAGE\n    ON SCHEMA housing_repairs_raw_zone\n    TO housing_repairs;\n\nGRANT SELECT\n    ON ALL TABLES IN SCHEMA housing_repairs_raw_zone\n    TO housing_repairs;\n")),(0,i.kt)("h2",{id:"storing-the-credentials-of-the-created-user-in-a-parameters-store"},"Storing the credentials of the created user in a parameters store?"),(0,i.kt)("h2",{id:"how-do-we-know-if-it-worked"},"How do we know if it worked?"),(0,i.kt)("h2",{id:"are-there-any-more-steps"},"Are there any more steps?"))}h.isMDXComponent=!0}}]);