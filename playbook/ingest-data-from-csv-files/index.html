<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/Data-Platform-Playbook/blog/rss.xml" title="Hackney Data Platform Playbook Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/Data-Platform-Playbook/blog/atom.xml" title="Hackney Data Platform Playbook Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Hackney Data Platform Playbook" href="/Data-Platform-Playbook/opensearch.xml"><title data-react-helmet="true">Ingest manually uploaded csv files | Hackney Data Platform Playbook</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Ingest manually uploaded csv files | Hackney Data Platform Playbook"><meta data-react-helmet="true" name="description" content="Ingest data from csv files"><meta data-react-helmet="true" property="og:description" content="Ingest data from csv files"><meta data-react-helmet="true" property="og:url" content="https://playbook.hackney.gov.uk/Data-Platform-Playbook//Data-Platform-Playbook/playbook/ingest-data-from-csv-files"><link data-react-helmet="true" rel="shortcut icon" href="/Data-Platform-Playbook/img/favicon.png"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://playbook.hackney.gov.uk/Data-Platform-Playbook//Data-Platform-Playbook/playbook/ingest-data-from-csv-files"><link rel="stylesheet" href="/Data-Platform-Playbook/styles.2116970b.css">
<link rel="stylesheet" href="/Data-Platform-Playbook/main.4a16e2e4.css">
<link rel="preload" href="/Data-Platform-Playbook/styles.73531a94.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/runtime~main.a45c9363.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/main.ebc52c9c.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/1.9be9882c.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/2.50325795.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/47.1f51667e.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/50.9956d282.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/935f2afb.d1bcf322.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/17896441.2879027c.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/3f665d90.e5dacf7b.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/Data-Platform-Playbook/"><img src="/Data-Platform-Playbook/img/logo-long.svg" alt="Data Platform Playbook" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/Data-Platform-Playbook/img/logo-long.svg" alt="Data Platform Playbook" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Data Platform Playbook</strong></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/LBHackney-IT/data-platform-playbook" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/Data-Platform-Playbook/"><img src="/Data-Platform-Playbook/img/logo-long.svg" alt="Data Platform Playbook" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/Data-Platform-Playbook/img/logo-long.svg" alt="Data Platform Playbook" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Data Platform Playbook</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://github.com/LBHackney-IT/data-platform-playbook" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/Data-Platform-Playbook/release-notes">Release Notes</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">About</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/zones">Zones</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/environments">Environments</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Playbook</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/connecting-to-redshift-from-data-studio">Connecting to the redshift cluster from Google Data Studio</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/exporting-snapshot-to-landing-zone">Exporting database snapshot to the Data Platform Landing Zone</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/google-sheets-import">Google Sheets import</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/import-files-from-google-to-S3">Import files from google to s3</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/Data-Platform-Playbook/playbook/ingest-data-from-csv-files">Ingest manually uploaded csv files</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/playbook">Playbook</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/querying-data-using-sql">Querying the Platform using SQL</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/scheduling-liberator-glue-jobs">Scheduling Liberator Glue Jobs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/using-glue-studio">Using Glue Studio</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Technical Documentation</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/docs/docs">Docs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/docs/exporting-snapshot-to-landing-zone">Exporting database snapshots to the Data Platform Landing Zone</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Architecture Decision</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/architecture-decisions/index">Introduction</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Records</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/architecture-decisions/0001-record-architecture-decisions">Record architecture decisions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/architecture-decisions/0002-ingest-google-sheets-data">Ingest Google Sheets Data</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/architecture-decisions/0003-role-based-access-control">Role-Based Access Control</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/architecture-decisions/0004-partition-strategy">Partition Strategy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/architecture-decisions/0005-recovered-data">Recovered Data</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/architecture-decisions/0006-ingest-sql-flat-files">Ingest SQL flat files</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/architecture-decisions/0007-sftp-to-s3-lambda">Copy Liberator data from sftp to s3</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/architecture-decisions/0008-production-data-in-staging">production-data-in-staging</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/architecture-decisions/index">Introduction</a></li></ul></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Ingest manually uploaded csv files</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="prerequisites"></a>Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">#</a></h2><ul><li>You have some structured data files you wish to have available from the Data Platform</li><li>You have access to the Hackney Data Platform</li><li>The department you are placing this data into the data platform has the manual CSV upload
functionality enabled.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="steps"></a>Steps<a class="hash-link" href="#steps" title="Direct link to heading">#</a></h2><ul><li><p>Ensure your data meets the following requirments before proceeding.</p><ul><li>You have saved the data as a &quot;CSV&quot; file format, using a comma to separate fields.
When <a href="https://docs.workstars.com/en/latest/howto/save-csv-utf8.html" target="_blank" rel="noopener noreferrer">exporting from Excel</a>, select the &quot;CSV UTF-8&quot; option.</li><li>The first row of the CSV contains the names of the columns as you wish them
to appear within the Data Platform.
If there are any empty rows before the column names delete them before exporting
the file.</li></ul></li><li><p>Sign in to the AWS Management Console and open the <a href="https://console.aws.amazon.com/s3/" target="_blank" rel="noopener noreferrer">Amazon S3 console</a>.</p></li><li><p>In the Buckets list, select the landing zone bucket, at
<a href="https://s3.console.aws.amazon.com/s3/buckets/dataplatform-stg-landing-zone?region=eu-west-2&amp;tab=objects" target="_blank" rel="noopener noreferrer">dataplatform-stg-landing-zone</a>.
Navigate to your departments manual upload folder, see below for structure.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;department&gt;/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">â””â”€â”€ manual/</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></li><li><p>Inside of the manual folder, create a new folder for the dataset you wish to create inside the data platform.
The name of the folder you create here will be used as the table name for the datasource throughout the platform.
If you are appending data to an already existing dataset, you can skip this step.</p></li><li><p>Inside of your dataset folder, upload a CSV containing your dataset by clicking the &quot;Add files&quot; button
and selecting the local files you want to upload then afterwards click the &quot;Upload&quot; button.
Alternatively, you can use &quot;Add folder&quot; taking care not to have any files in your local folder that you do not want to upload.
Any CSVs uploaded within this folder will be combined into one dataset, and should have a matching set of columns.
The status of each file should say &quot;Upload succeeded&quot;, then click on the &quot;Close&quot; button.</p></li><li><p>Now go to <a href="https://eu-west-2.console.aws.amazon.com/glue/home?region=eu-west-2#etl:tab=jobs" target="_blank" rel="noopener noreferrer">AWS Glue Jobs</a>, where you will run the job called
<code>&lt;department&gt; copy manually uploaded CSVs to raw</code>.
Select this job and click the &quot;Run job&quot; option in the Action pull-down menu.
If a &quot;Parameters&quot; dialogue box appears then click &quot;Run job&quot;.</p></li><li><p>Reselect the Job, observe the progress of its run within the &quot;History&quot; tab, and wait
for the &quot;Run status&quot; to reach &quot;Succeeded&quot;.
This job will have created a S3 folder structure as shown below inside the <a href="/Data-Platform-Playbook/zones#raw-zone">Raw zone</a>
and an Apache Parquet file containing your CSV data inside of there.
You can check the output by navigating to S3 Bucket <a href="https://s3.console.aws.amazon.com/s3/buckets/dataplatform-stg-raw-zone?region=eu-west-2&amp;tab=objects" target="_blank" rel="noopener noreferrer">dataplatform-stg-raw-zone</a>,
confirming the folder structure, and observing that Apache Parquet file(s) have been created.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;department&gt;/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">â””â”€â”€ manual/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    â””â”€â”€ &lt;dataset-name&gt;/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        â””â”€â”€ import_year=&lt;year&gt;/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            â””â”€â”€ import_month=&lt;month&gt;/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                â””â”€â”€ import_day=&lt;day&gt;/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    â””â”€â”€ part-xxxxx-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx.xxxx.snappy.parquet</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></li></ul><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>Files uploaded to the CSV folder will only be copied over to the raw zone once.</p><p>The job uses the CSVs &quot;created at&quot; timestamp to process only the CSVs which have been uploaded since the last time the job successfully ran.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="confirm-the-import-worked"></a>Confirm the import worked<a class="hash-link" href="#confirm-the-import-worked" title="Direct link to heading">#</a></h2><p>Next we&#x27;ll confirm the data has been imported correctly by crawling the data with
<a href="https://eu-west-2.console.aws.amazon.com/glue/home?region=eu-west-2#catalog:tab=crawlers" target="_blank" rel="noopener noreferrer">AWS Glue Crawler</a> and then inspecting it within
<a href="/Data-Platform-Playbook/playbook/querying-data-using-sql">AWS Athena</a>.</p><ul><li><p>Before accessing the data within Athena, you will need to run the crawler for this data.
Navigate to the <a href="https://eu-west-2.console.aws.amazon.com/glue/home?region=eu-west-2#catalog:tab=crawlers" target="_blank" rel="noopener noreferrer">AWS Glue Crawler</a> interface, select the crawler named
<code>data-platform-stg-raw-zone-&lt;department&gt;-manual-uploads-crawler</code>, then click on &quot;Run crawler&quot;.
Wait until its status returns to &quot;Ready&quot;.
Check the &quot;Last runtime&quot; of previous jobs to get an idea of how long you might have to wait.</p></li><li><p>Once crawled, there will be a newly created table within the database which you can access in <a href="https://eu-west-2.console.aws.amazon.com/athena/home?region=eu-west-2#query" target="_blank" rel="noopener noreferrer">Athena</a> as
<code>dataplatform-stg-raw-zone-&lt;department&gt;-manual-uploads-database</code>.
You should see a table eg. &quot;cake_designs&quot; with the column names as per the CSV header.
You should also see various &quot;import_...&quot; columns at the end some of which are marked (Partitioned).
You can then view the newly imported tables under the tables tab.
Note: The original names of the files, when they were uploaded, is not captured here at the moment.</p></li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/LBHackney-IT/data-platform-playbook/edit/master/docs/playbook/ingest-data-from-csv-files.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/Data-Platform-Playbook/playbook/import-files-from-google-to-S3"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Import files from google to s3</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/Data-Platform-Playbook/playbook/playbook"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Playbook Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#prerequisites" class="table-of-contents__link">Prerequisites</a></li><li><a href="#steps" class="table-of-contents__link">Steps</a></li><li><a href="#confirm-the-import-worked" class="table-of-contents__link">Confirm the import worked</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Made by HackIT.</div></div></div></footer></div>
<script src="/Data-Platform-Playbook/styles.73531a94.js"></script>
<script src="/Data-Platform-Playbook/runtime~main.a45c9363.js"></script>
<script src="/Data-Platform-Playbook/main.ebc52c9c.js"></script>
<script src="/Data-Platform-Playbook/1.9be9882c.js"></script>
<script src="/Data-Platform-Playbook/2.50325795.js"></script>
<script src="/Data-Platform-Playbook/47.1f51667e.js"></script>
<script src="/Data-Platform-Playbook/50.9956d282.js"></script>
<script src="/Data-Platform-Playbook/935f2afb.d1bcf322.js"></script>
<script src="/Data-Platform-Playbook/17896441.2879027c.js"></script>
<script src="/Data-Platform-Playbook/3f665d90.e5dacf7b.js"></script>
</body>
</html>