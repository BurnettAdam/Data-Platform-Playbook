<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/Data-Platform-Playbook/blog/rss.xml" title="Hackney Data Platform Playbook Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/Data-Platform-Playbook/blog/atom.xml" title="Hackney Data Platform Playbook Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Hackney Data Platform Playbook" href="/Data-Platform-Playbook/opensearch.xml"><title data-react-helmet="true">Exporting database snapshot to the Data Platform Landing Zone | Hackney Data Platform Playbook</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Exporting database snapshot to the Data Platform Landing Zone | Hackney Data Platform Playbook"><meta data-react-helmet="true" name="description" content="Exporting a snapshot of an rds instance in AWS to the DataPlatform landing zone"><meta data-react-helmet="true" property="og:description" content="Exporting a snapshot of an rds instance in AWS to the DataPlatform landing zone"><meta data-react-helmet="true" property="og:url" content="https://playbook.hackney.gov.uk/Data-Platform-Playbook//Data-Platform-Playbook/playbook/exporting-snapshot-to-landing-zone"><link data-react-helmet="true" rel="shortcut icon" href="/Data-Platform-Playbook/img/favicon.png"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://playbook.hackney.gov.uk/Data-Platform-Playbook//Data-Platform-Playbook/playbook/exporting-snapshot-to-landing-zone"><link rel="stylesheet" href="/Data-Platform-Playbook/styles.2116970b.css">
<link rel="stylesheet" href="/Data-Platform-Playbook/main.4a16e2e4.css">
<link rel="preload" href="/Data-Platform-Playbook/styles.92f146c8.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/runtime~main.20ae405c.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/main.d00007fe.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/1.2894be70.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/2.e8758fdd.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/46.7f017491.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/49.9584ba59.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/935f2afb.8e976f0e.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/17896441.d1414991.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/83dedc1b.4c15f67a.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/Data-Platform-Playbook/"><img src="/Data-Platform-Playbook/img/logo-long.svg" alt="Data Platform Playbook" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/Data-Platform-Playbook/img/logo-long.svg" alt="Data Platform Playbook" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Data Platform Playbook</strong></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/LBHackney-IT/data-platform-playbook" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/Data-Platform-Playbook/"><img src="/Data-Platform-Playbook/img/logo-long.svg" alt="Data Platform Playbook" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/Data-Platform-Playbook/img/logo-long.svg" alt="Data Platform Playbook" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Data Platform Playbook</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://github.com/LBHackney-IT/data-platform-playbook" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/Data-Platform-Playbook/release-notes">Release Notes</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">About</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/zones">Zones</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/environments">Environments</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Playbook</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/connecting-to-redshift-from-data-studio">Connecting to the redshift cluster from Google Data Studio</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/Data-Platform-Playbook/playbook/exporting-snapshot-to-landing-zone">Exporting database snapshot to the Data Platform Landing Zone</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/google-sheets-import">Google Sheets import</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/ingest-data-from-csv-files">Ingest manually uploaded csv files</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/playbook">Playbook</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/querying-data-using-sql">Querying the Platform using SQL</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/scheduling-liberator-glue-jobs">Scheduling Liberator Glue Jobs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/using-glue-studio">Using Glue Studio</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Technical Documentation</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/docs/docs">Docs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/docs/exporting-snapshot-to-landing-zone">Exporting database snapshots to the Data Platform Landing Zone</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Architecture Decision</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/architecture-decisions/index">Introduction</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Records</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/architecture-decisions/0001-record-architecture-decisions">Record architecture decisions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/architecture-decisions/0002-ingest-google-sheets-data">Ingest Google Sheets Data</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/architecture-decisions/0003-role-based-access-control">Role-Based Access Control</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/architecture-decisions/0004-partition-strategy">Partition Strategy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/architecture-decisions/0005-recovered-data">Recovered Data</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/architecture-decisions/0006-ingest-sql-flat-files">Ingest SQL flat files</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/architecture-decisions/0007-sftp-to-s3-lambda">Copy Liberator data from sftp to s3</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/architecture-decisions/0008-production-data-in-staging">production-data-in-staging</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/architecture-decisions/index">Introduction</a></li></ul></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Exporting database snapshot to the Data Platform Landing Zone</h1></header><div class="markdown"><p>This guide explains the process of ingesting data from a RDS instance in the AWS API accounts to the Data Platform landing zone by creating db snapshots.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="add-rds-instance-id-to-the-environment-variables"></a>Add rds instance id to the environment variables<a class="hash-link" href="#add-rds-instance-id-to-the-environment-variables" title="Direct link to heading">#</a></h2><p>In this section, you will be adding the rds instance id to the environment variables in Terraform, which will provision the necessary resources in AWS to create an event subscription on that database instance. Therefore, each time a database snapshot is created, it will begin the process of exporting that data to the Data Platform landing zone.</p><ul><li>Ensure you have access to the <a href="https://github.com/LBHackney-IT/data-platform/" target="_blank" rel="noopener noreferrer">Data Platform repository</a></li><li>Login to the AWS management console for the account where the rds instance is located (for UPRN this will be <code>ProductionAPIs</code>)<ul><li>Currently, the deployment is set up to only deploy to the Staging and Production API accounts. This will be refactored to allow us to release into multiple accounts</li></ul></li><li>Search for <code>RDS</code> and select</li><li>Select <code>DB Instances</code> in the <code>Resources</code> section</li><li>Copy the <code>DB identifier</code> of the database you want to export</li><li>Navigate to <a href="https://github.com/LBHackney-IT/Data-Platform/blob/main/config/terraform/prod.tfvars#L12" target="_blank" rel="noopener noreferrer">prod.tfvars</a> in the <code>config/terraform</code> directory and click the pencil icon to edit the file</li><li>Add the <code>Db Identifier</code> to the <code>rds_instance_ids</code> environment variable by pasting it to the end of the list as shown below. Ensure you do not remove existing instance ids and that each instance id is double-quoted and comma separated.</li></ul><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">rds_instance_ids = [&quot;rds-instance-1&quot;, &quot;rds-instance-2&quot;, &quot;YOUR_DB_INSTANCE_ID&quot;]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><em>The <code>rds_instance_ids</code> environment variable lists all the RDS instances that are configured to export to the Data Platform landing zone</em> </p><ul><li><p>Once the rds instance id has been added, navigate to the bottom of the page to the <code>Commit changes</code> section and add a short descriptive commit message in the first input field (80 characters max) and an optional description in the second input field</p></li><li><p>Select the radio button labelled <code>Create a new branch for this commit and start a pull request</code> and give the new branch an appropriate name (separate words by dashes)</p></li><li><p>Select <code>Commit changes</code></p></li><li><p>Populate the pull request template and select <code>Create pull request</code></p></li><li><p>Your pull request is now ready for review by the Data Platform team, and your changes will be applied once they have approved and merged your pull request, and a new production release has been made</p></li><li><p>After your pull request has been approved and merged, you will be able to view the progress of the staging deployment. Once completed, the Data Platform team will then create a production release which will deploy your changes to production. You can view the progress of these steps by navigating to the <code>Data-Platform (Staging)</code> and <code>Data-Platform (Production)</code> workflows in the <a href="https://github.com/LBHackney-IT/Data-Platform/actions" target="_blank" rel="noopener noreferrer">actions tab</a> of the repository.</p><ul><li><p>The workflow for the staging deployment will contain the following text under the workflow title:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Data-Platform (Staging) #xxx: Commit xxxx pushed by xxxxx</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></li><li><p>The production release workflow will contain the following text under the workflow title:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Data-Platform (Production) #x: Release x.x.x published by xxxxx</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></li></ul></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="create-a-snapshot-of-the-rds-instance"></a>Create a snapshot of the rds instance<a class="hash-link" href="#create-a-snapshot-of-the-rds-instance" title="Direct link to heading">#</a></h2><p>Once your pull request has been approved and released to production, you will need to log in to the AWS account where your RDS instance exists, to create a snapshot of it. The creation of this snapshot will trigger the export process of the data to the Data Platform landing zone.</p><ul><li><p>Search for <code>RDS</code> and select</p></li><li><p>On the sidebar, select <code>Snapshots</code></p></li><li><p>Select <code>Take snapshot</code> on the Manual tab</p></li><li><p>On <code>Take a Snapshot</code> page, use the <code>DB Instance</code> drop down and select the rds instance id as your DB instance</p><p>  In the <code>Snapshot Name</code> input field, enter a unique name for your snapshot according to the following convention: <code>dataplatform-YYYY-MM-DD-rds_instance_id</code>. See example below:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">dataplatform-2021-05-15-golive-db</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>  If you&#x27;re creating more than one snapshot to be exported on the same day, you would need to make the snapshot name unique by adding a <code>snapshot_version</code> after the date according to the following convention: <code>dataplatform-YYYY-MM-DD-snapshot_version-rds_instance_id</code>. For example if this is your second snapshot in the same day, you can name as follows:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">dataplatform-2021-05-15-v2-golive-db</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></li><li><p>Select <code>Take snapshot</code></p></li><li><p>The snapshot should immediately appear in the <code>Manual snapshots</code> list under the <code>Manual</code> tab</p></li><li><p>The snapshot is complete when it has a <code>Snapshot creation time</code> (this will take a few minutes to complete)</p></li><li><p>Once the snapshot has been created, it will automatically trigger the export process to the Data Platform landing zone bucket. The export process is made up of two steps which in total will take about an hour to complete: </p><ul><li>First it will export a copy of the database instance in parquet format to an S3 bucket (Amazon Simple Storage Service) in the same service account. You can view the progress of this first export by navigating to the <code>Exports in Amazon S3</code> tab (this takes just under an hour to complete). Once complete, you can view the initial snapshot export by clicking on the link in the <code>S3 bucket</code> column which will take you to the relevant directory in the <code>dataplatform-prod-rds-export-storage</code> S3 bucket where all the initial exports are stored. </li><li>The second step will copy the data from the <code>dataplatform-prod-rds-export-storage</code> S3 bucket to the landing zone S3 bucket in the Data Platform account (see <a href="http://playbook.hackney.gov.uk/Data-Platform-Playbook/docs/exporting-snapshot-to-landing-zone/" target="_blank" rel="noopener noreferrer">exporting db snapshots to the landing zone</a> for more detail on the ingestion process). Shortly after this, the data will become available in the Data Platform account.</li></ul></li><li><p>Verify that your exported data is in the Data Platform landing zone:</p><ul><li>Switch to the <code>DataPlatform-Production</code> account</li><li>Search for <code>S3</code> and select</li><li>Select <code>dataplatform-prod-landing-zone</code> and navigate to the relevant department folder</li></ul></li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/LBHackney-IT/data-platform-playbook/edit/master/docs/playbook/exporting-snapshot-to-landing-zone.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/Data-Platform-Playbook/playbook/connecting-to-redshift-from-data-studio"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Connecting to the redshift cluster from Google Data Studio</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/Data-Platform-Playbook/playbook/google-sheets-import"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Google Sheets import Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#add-rds-instance-id-to-the-environment-variables" class="table-of-contents__link">Add rds instance id to the environment variables</a></li><li><a href="#create-a-snapshot-of-the-rds-instance" class="table-of-contents__link">Create a snapshot of the rds instance</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Made by HackIT.</div></div></div></footer></div>
<script src="/Data-Platform-Playbook/styles.92f146c8.js"></script>
<script src="/Data-Platform-Playbook/runtime~main.20ae405c.js"></script>
<script src="/Data-Platform-Playbook/main.d00007fe.js"></script>
<script src="/Data-Platform-Playbook/1.2894be70.js"></script>
<script src="/Data-Platform-Playbook/2.e8758fdd.js"></script>
<script src="/Data-Platform-Playbook/46.7f017491.js"></script>
<script src="/Data-Platform-Playbook/49.9584ba59.js"></script>
<script src="/Data-Platform-Playbook/935f2afb.8e976f0e.js"></script>
<script src="/Data-Platform-Playbook/17896441.d1414991.js"></script>
<script src="/Data-Platform-Playbook/83dedc1b.4c15f67a.js"></script>
</body>
</html>