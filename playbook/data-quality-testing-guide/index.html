<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/Data-Platform-Playbook/blog/rss.xml" title="Hackney Data Platform Playbook Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/Data-Platform-Playbook/blog/atom.xml" title="Hackney Data Platform Playbook Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Hackney Data Platform Playbook" href="/Data-Platform-Playbook/opensearch.xml"><title data-react-helmet="true">Guide to testing data quality in Glue Jobs | Hackney Data Platform Playbook</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Guide to testing data quality in Glue Jobs | Hackney Data Platform Playbook"><meta data-react-helmet="true" name="description" content="A guide to continuous data quality testing in Glue Jobs"><meta data-react-helmet="true" property="og:description" content="A guide to continuous data quality testing in Glue Jobs"><meta data-react-helmet="true" property="og:url" content="https://playbook.hackney.gov.uk/Data-Platform-Playbook//Data-Platform-Playbook/playbook/data-quality-testing-guide"><link data-react-helmet="true" rel="shortcut icon" href="/Data-Platform-Playbook/img/favicon.png"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://playbook.hackney.gov.uk/Data-Platform-Playbook//Data-Platform-Playbook/playbook/data-quality-testing-guide"><link rel="stylesheet" href="/Data-Platform-Playbook/styles.2116970b.css">
<link rel="stylesheet" href="/Data-Platform-Playbook/main.5883e267.css">
<link rel="preload" href="/Data-Platform-Playbook/styles.30f54d37.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/runtime~main.9b7f42ed.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/main.9288674a.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/1.98e0a220.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/2.d53b06a0.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/54.5dc6cdf6.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/57.a3806d88.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/935f2afb.0a768073.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/17896441.3e94a400.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/3e67983e.3c2b0074.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/Data-Platform-Playbook/"><img src="/Data-Platform-Playbook/img/logo-long.svg" alt="Data Platform Playbook" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/Data-Platform-Playbook/img/logo-long.svg" alt="Data Platform Playbook" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Data Platform Playbook</strong></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/LBHackney-IT/data-platform-playbook" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/Data-Platform-Playbook/"><img src="/Data-Platform-Playbook/img/logo-long.svg" alt="Data Platform Playbook" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/Data-Platform-Playbook/img/logo-long.svg" alt="Data Platform Playbook" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Data Platform Playbook</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://github.com/LBHackney-IT/data-platform-playbook" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/Data-Platform-Playbook/release-notes">Release Notes</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">About</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/zones">Zones</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/environments">Environments</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Playbook</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/connecting-to-redshift-from-data-studio">Connecting to the redshift cluster from Google Data Studio</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/create_a_data_extract_in_GDS">Create a data extract in Google Data Studio</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/Data-Platform-Playbook/playbook/data-quality-testing-guide">Guide to testing data quality in Glue Jobs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/exporting-snapshot-to-landing-zone">Exporting database snapshot to the Data Platform Landing Zone</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/google-sheets-import">Google Sheets import</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/import-files-from-google-to-S3">Import files from google to s3</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/import-xlsx-from-g-drive">Import XLXS from G Drive</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/ingest-data-from-csv-files">Ingest manually uploaded csv files</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/onboarding-new-users-to-the-platform">Onboarding new users to the platform</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/querying-data-using-sql">Querying the Platform using SQL</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/scheduling-liberator-glue-jobs">Scheduling Liberator Glue Jobs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/unit-testing-guide">Guide to testing on the Data Platform</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/using-glue-studio">Using Glue Studio</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/workshop/aws_glue_studio_parking">Glue Studio workshop with Parking Analysts</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Technical Documentation</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/docs/docs">Docs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/docs/exporting-snapshot-to-landing-zone">Exporting database snapshots to the Data Platform Landing Zone</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/docs/import-xlsx-from-g-drive">Import XLXS from G Drive</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/docs/redshift">Redshift Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/docs/vpc-peering-connection-dataplatform-and-production-apis-account">VPC Peering Connection between Data Platform and Production APIs AWS accounts</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Architecture Decision</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/architecture-decisions/index">Introduction</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Records</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/architecture-decisions/0001-record-architecture-decisions">Record architecture decisions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/architecture-decisions/0002-ingest-google-sheets-data">Ingest Google Sheets Data</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/architecture-decisions/0003-role-based-access-control">Role-Based Access Control</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/architecture-decisions/0004-partition-strategy">Partition Strategy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/architecture-decisions/0005-recovered-data">Recovered Data</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/architecture-decisions/0006-ingest-sql-flat-files">Ingest SQL flat files</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/architecture-decisions/0007-sftp-to-s3-lambda">Copy Liberator data from sftp to s3</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/architecture-decisions/0008-production-data-in-staging">production-data-in-staging</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/architecture-decisions/0009-ingesting-data-from-apis">Ingesting data from APIs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/architecture-decisions/0010-using-pytest-for-verifying-pyspark-transformations">Using pytest for verifying PySpark transformations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/architecture-decisions/index">Introduction</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Spikes</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/spikes/0005-qlik-integration">Qlik Integration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/spikes/0007-data-quality-testing">Data Quality Testing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/spikes/0008-datahub-deployment">Datahub deployment</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Data-Platform-Playbook/spikes/0009-amundsen-deployment">Amundsen deployment</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Guide to testing data quality in Glue Jobs</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="resources"></a>Resources<a class="hash-link" href="#resources" title="Direct link to heading">#</a></h2><ul><li><a href="https://github.com/awslabs/python-deequ" target="_blank" rel="noopener noreferrer">PyDeequ README</a></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="prerequisites"></a>Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">#</a></h2><p>Update the job arguments of your Glue job to include:</p><ul><li>Extra jars: <code>--extra-jars = s3://dataplatform-stg-glue-scripts/jars/deequ-1.0.3.jar</code> </li><li>Extra Python files: <code>--extra-py-file = s3://dataplatform-stg-glue-scripts/python-modules/pydeequ-1.0.1.zip</code> </li><li>Metrics repository S3 target location using the template format:
<code>--deequ_metrics_location = s3://dataplatform-stg-EXAMPLE-zone/quality-metrics/department=EXAMPLE/dataset=EXAMPLE/deequ-metrics.json</code></li></ul><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>There is a <a href="https://github.com/awslabs/python-deequ/issues/7" target="_blank" rel="noopener noreferrer">defect with PyDeequ</a> which causes the Glue Spark session to hang.
While this issue still exists, we recommend wrapping your data quality verification code in a &quot;try/finally&quot; block (see example <a href="https://github.com/LBHackney-IT/Data-Platform/blob/6468778d865c6203d1d11df78805720da9cd22b5/scripts/elec_mech_fire_tv_aerials_cleaning.py#L79-L105" target="_blank" rel="noopener noreferrer">here</a>).</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-python codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">try</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">finally</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    spark_session</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sparkContext</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">_gateway</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">close</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    spark_session</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">stop</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="example-check"></a>Example Check<a class="hash-link" href="#example-check" title="Direct link to heading">#</a></h3><p>Here is an example of using deequ checks to validate a dataframe, and storing related metrics to S3.
The <code>description_of_work</code> column is checked to be complete, and <code>work_priority_priority_code</code> between
1 and 4 inclusively.
There is also the option to include a hint message on each of the checks which will be
displayed to the user in the event there is a failing constraint to help diagnose the problem.
For example, the <code>hasMin</code> check has the hint message: &quot;<code>The minimum(work_priority_priority_code) &gt;= 1&#x27;)</code>&quot;. </p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-python codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> helpers </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> get_metrics_target_location</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> pydeequ</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">checks </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> Check</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> CheckLevel</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> pydeequ</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">repository </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> FileSystemMetricsRepository</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ResultKey</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> pydeequ</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">verification </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> VerificationSuite</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> VerificationResult</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> RelativeRateOfChangeStrategy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">metrics_target_location </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> get_metrics_target_location</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">metricsRepository </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> FileSystemMetricsRepository</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">spark_session</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> metrics_target_location</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resultKey </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> ResultKey</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">spark_session</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ResultKey</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">current_milli_time</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">checkResult </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> VerificationSuite</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">spark_session</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">onData</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">df</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">useRepository</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">metricsRepository</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">addCheck</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">Check</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">spark_session</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> CheckLevel</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;data quality checks&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">hasMin</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;work_priority_priority_code&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">lambda</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;The minimum(work_priority_priority_code) &gt;= 1&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">hasMax</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;work_priority_priority_code&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">lambda</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;The maximum(work_priority_priority_code) &lt;= 4&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">  \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">isComplete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;description_of_work&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">saveOrAppendResult</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">resultKey</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">checkResult_df </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> VerificationResult</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">checkResultsAsDataFrame</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">spark_session</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> checkResult</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">checkResult_df</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">show</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Here is a <a href="https://pydeequ.readthedocs.io/en/latest/pydeequ.html#module-pydeequ.checks" target="_blank" rel="noopener noreferrer">list of checks</a> that are available to use.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="example-anomaly-detection"></a>Example Anomaly Detection<a class="hash-link" href="#example-anomaly-detection" title="Direct link to heading">#</a></h3><p>Anomaly detection uses historic metrics to determine if a value is invalid.</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>You can only run an anomaly check if there are historic metrics results in the metrics repository you are using.
If no historic metrics results exist, you will get the below error message:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-markdown codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Can&#x27;t execute the assertion: requirement failed: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">There have to be previous results in the MetricsRepository!!</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>To avoid this error, run the standard verification constraint checks first (see <a href="#example-check">Example Check</a> section above) and then add your anomaly constraint checks afterwards.</p></div></div><p>For example, we check if the size of a dataframe has increased by more than twice the previous size.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-python codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> helpers </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> get_metrics_target_location</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> cancel_job_if_failing_quality_checks</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> pydeequ</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">verification </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> VerificationSuite</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> VerificationResult</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> pydeequ</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">repository </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> FileSystemMetricsRepository</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ResultKey</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> pydeequ</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">anomaly_detection </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> RelativeRateOfChangeStrategy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">metrics_target_location </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> get_metrics_target_location</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">metricsRepository </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> FileSystemMetricsRepository</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">spark_session</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> metrics_target_location</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resultKey </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> ResultKey</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">spark_session</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ResultKey</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">current_milli_time</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">anomalyVerificationSuite </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> VerificationSuite</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">spark_session</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">onData</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">df</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">useRepository</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">metricsRepository</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">addAnomalyCheck</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">RelativeRateOfChangeStrategy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">maxRateIncrease </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2.0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> Size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cancel_job_if_failing_quality_checks</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">VerificationResult</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">checkResultsAsDataFrame</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">spark_session</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> anomalyVerificationSuite</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Only update the metrics repository if cancel_job_if_failing_quality_checks succeeds.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Otherwise the next time anomaly check runs it will compare against &quot;incorrect&quot; metrics.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">anomalyVerificationSuite</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">saveOrAppendResult</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">resultKey</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Here is a <a href="https://pydeequ.readthedocs.io/en/latest/pydeequ.html#module-pydeequ.checks" target="_blank" rel="noopener noreferrer">list of anomaly detection types</a> that are available to use.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="providing-tags-to-metrics-for-verification-constraint-checks"></a>Providing tags to metrics for verification constraint checks<a class="hash-link" href="#providing-tags-to-metrics-for-verification-constraint-checks" title="Direct link to heading">#</a></h3><p>You can add tags to your verification metrics which may be helpful when reviewing the metric
results for a particular job.
To do this, include a dictionary containing key value pairs in the <code>ResultKey</code> as shown in example below:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-python codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> sys</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> awsglue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">utils </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> getResolvedOptions</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">args </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> getResolvedOptions</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sys</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">argv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;JOB_NAME&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">resultKey </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> ResultKey</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">spark_session</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ResultKey</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">current_milli_time</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;source_database&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> source_catalog_database</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;source_table&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> source_catalog_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;glue_job_id&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;JOB_RUN_ID&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="stopping-glue-jobs-when-constraint-checks-fail"></a>Stopping Glue jobs when constraint checks fail<a class="hash-link" href="#stopping-glue-jobs-when-constraint-checks-fail" title="Direct link to heading">#</a></h3><p>In order to ensure that only trusted data is outputted from your Glue job, it is important
to make an assertion against your constraints to check that they have been satisfied.</p><p>You can do this by including a helper function called <code>cancel_job_if_failing_quality_checks()</code>
in your script (see <a href="https://github.com/LBHackney-IT/Data-Platform/blob/main/scripts/helpers.py" target="_blank" rel="noopener noreferrer">helpers.py</a> for more info).
You can see an example usage in the <a href="#example-anomaly-detection">Example Anomaly Detection</a> section.</p><p>When a constraint check fails, the Glue job will fail and, an error message will be provided which might look something like
the below message:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-markdown codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Exception: data quality checks. Value: 1.0 does not meet the constraint requirement!</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  The minimum(work_priority_priority_code) &gt;= 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | Anomaly check for Size(None). Value: 486.0 does not meet the constraint requirement!</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Multiple constraint failures are delimited by a <code>|</code> character in the error message.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="email-notifications-of-failing-glue-jobs"></a>Email notifications of failing Glue jobs<a class="hash-link" href="#email-notifications-of-failing-glue-jobs" title="Direct link to heading">#</a></h3><p>Each time a Glue job fails as a result of failing constraint checks, an email notification with details of the error message is sent to the respective department, and their subscribed members.</p><p>The message will include:</p><ul><li>Name of the Glue job</li><li>Error message from the failing constraint check</li><li>Time of failure</li><li>Job start time</li><li>Job end time</li><li>Job last modified time</li><li>A link to log in to Hackney SSO and view the Job run details</li></ul><p>In order to receive email notifications, you will need to ensure that you are subscribed to receive emails from your department&#x27;s <a href="https://groups.google.com/my-groups" target="_blank" rel="noopener noreferrer">Google group</a> and that you have confirmed your subscription to receive AWS Notifications when prompted.</p><div class="admonition admonition-important alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</h5></div><div class="admonition-content"><p>Ensure the <strong>PlatformDepartment</strong> tag is correctly set in the <em>Advanced details</em> section in the Glue job&#x27;s <em>Job Details</em> (see <a href="https://playbook.hackney.gov.uk/Data-Platform-Playbook/playbook/using-glue-studio" target="_blank" rel="noopener noreferrer">Using Glue Studio</a>). </p></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/LBHackney-IT/data-platform-playbook/edit/master/docs/playbook/data-quality-testing-guide.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/Data-Platform-Playbook/playbook/create_a_data_extract_in_GDS"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Create a data extract in Google Data Studio</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/Data-Platform-Playbook/playbook/exporting-snapshot-to-landing-zone"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Exporting database snapshot to the Data Platform Landing Zone Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#resources" class="table-of-contents__link">Resources</a></li><li><a href="#prerequisites" class="table-of-contents__link">Prerequisites</a><ul><li><a href="#example-check" class="table-of-contents__link">Example Check</a></li><li><a href="#example-anomaly-detection" class="table-of-contents__link">Example Anomaly Detection</a></li><li><a href="#providing-tags-to-metrics-for-verification-constraint-checks" class="table-of-contents__link">Providing tags to metrics for verification constraint checks</a></li><li><a href="#stopping-glue-jobs-when-constraint-checks-fail" class="table-of-contents__link">Stopping Glue jobs when constraint checks fail</a></li><li><a href="#email-notifications-of-failing-glue-jobs" class="table-of-contents__link">Email notifications of failing Glue jobs</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Made by HackIT.</div></div></div></footer></div>
<script src="/Data-Platform-Playbook/styles.30f54d37.js"></script>
<script src="/Data-Platform-Playbook/runtime~main.9b7f42ed.js"></script>
<script src="/Data-Platform-Playbook/main.9288674a.js"></script>
<script src="/Data-Platform-Playbook/1.98e0a220.js"></script>
<script src="/Data-Platform-Playbook/2.d53b06a0.js"></script>
<script src="/Data-Platform-Playbook/54.5dc6cdf6.js"></script>
<script src="/Data-Platform-Playbook/57.a3806d88.js"></script>
<script src="/Data-Platform-Playbook/935f2afb.0a768073.js"></script>
<script src="/Data-Platform-Playbook/17896441.3e94a400.js"></script>
<script src="/Data-Platform-Playbook/3e67983e.3c2b0074.js"></script>
</body>
</html>